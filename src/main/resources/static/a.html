<!DOCTYPE html>
<html lang="zh-CN">
	<head>
	    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	    <title>vue example</title>
	    <style type="text/css">
			*{
				margin: 0;
				padding: 0;
				border: 0;
			}
			
			div{
				font-size:14px;
				border-style: dotted; 
				border-color: #000000 #000000 #000000 #000000; 
				border-width: 1px; 
				overflow:hidden;
				box-sizing: border-box;
			}
			
			body{
				height: 500px;
			}
			.container{
				width:98%;
				height:100%;
				margin-left:1%;
				margin-right:1%;
				display:table;
			}
			
			.modelBox{
				width:20%;
				height:100%;
				display:table-cell;
			}
			
			.canvasBox{
				width:auto;
				height:100%;
				display:table-cell;
			}
			
			.attributeBox{
				width:20%;
				height:100%;
				display:table-cell;
			}
			
			.tool{
				width: 100%;
				height: 20%;
			}
			
			.canvas{
				width: 100%;
				height: 80%;
			}
			
			ul{
				width: 100%;
			}
			
			li{
				width: 100%;
				height:60px;
				float: left;
				user-select: none;
			}
			
			li img{
				width: 50px;
				height:50px;
			}
		</style>
	</head>
	
	<body>
		<div class="container">
			<div class="modelBox">
				<ul>
					<li v-for="item in 10">
						<img alt="" @dragstart="dragstart" draggable="true" src="/img/server_monitor.png"> 服务器
					</li>
				</ul>
			</div>
			<div class="canvasBox">
				<div class="tool">
					<span style="float: left;width:200px;height: 30px">
						
						<input type="radio" @change='operaChange' name="opera" value="drag" checked="checked">
						 <label>拖拽</label>
						&nbsp;&nbsp;
						<input type="radio" @change='operaChange' name="opera" value="line">
						<label>连线</label>
					</span>
				</div>
				<div class="canvas">
					<canvas  id="canvas" @dragover='dragover' @drop="drop"></canvas>
				</div>
			</div>
			<div class="attributeBox"></div>
		</div>
	</body>
	
	<script type="text/javascript" src="/js/vue.js"></script>
	<script type="text/javascript" src="/js/jquery.js"></script>
	<script type="text/javascript" src="/js/jtopo-min.js"></script>
	<script type="text/javascript" src="/js/toolbar.js"></script>
	<script type="text/javascript">
		new Vue({
			el: '.container',
			data: {
				stage:null,
				scene:null,
				opera:'drag',
				node:[],
				line:[],
			},
			 methods: {
				 dragstart: function(event){
					 event.dataTransfer.setData("src",event.target.src);
				 },
				 dragover: function(event){
					 event.preventDefault();
				 },
				 drop: function(event){
					event.preventDefault();
					var data=event.dataTransfer.getData("src");
					var node = new JTopo.Node("Hello");
					node.setImage(data)
					node.setLocation(event.offsetX,event.offsetY);
					this.scene.add(node);
					this.node.push(node);
					 
				 },
				 operaChange:function(e){
					var val = e.target.value;
					switch(val){
					case 'line':
						this.opera = 'line';
						for(var i=0;i<this.node.length;i++){
							this.node[i].dragable = false
						}
						break;
					case 'drag':
						this.opera = 'drag';
						for(var i=0;i<this.node.length;i++){
							this.node[i].dragable = true
						}
						break;
					default:
						  ;
					}
				 }
			 },
			 ready: function(){
					var canvas = document.getElementById('canvas'); 
					canvas.width = canvas.parentElement.offsetWidth;
					canvas.height = canvas.parentElement.offsetHeight;
					
					this.stage = new JTopo.Stage(canvas);
					this.scene = new JTopo.Scene(this.stage);
					
					var scene = this.scene;
					var data = this;
					var beginNode = null;
					var from = new JTopo.Node("from");
					from.setSize(1, 1);
					var to = new JTopo.Node("to");
					to.setSize(1, 1);
					var link = new JTopo.Link(from, to);
		            
		            scene.mousedown(function(e){
		            	if(data.opera == 'line' && e.target != null && e.target instanceof JTopo.Node){
	                        beginNode = e.target;
	                        scene.add(link);
	                        from.setLocation(e.x, e.y);
	                        to.setLocation(e.x, e.y);
	                        debugger
	                        e.preventDefault();
		            	}
		            	
			            scene.mousemove(function(e){
			            	if(data.opera == 'line' && beginNode != null){
			            		to.setLocation(e.x, e.y);
			            	}
			            });
			            
			            scene.mouseup(function(e){

			            });
		            });
			 }
		})
	</script>
</html>